(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[285],{8747:function(e,t,s){Promise.resolve().then(s.bind(s,3522))},3522:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return l}});var a=s(7437),n=s(2265);let i="http://Noel-ALB-780957247.ap-south-1.elb.amazonaws.com/api";function l(){let[e,t]=(0,n.useState)([]),[s,l]=(0,n.useState)([]),[c,d]=(0,n.useState)(""),[r,o]=(0,n.useState)(0),[u,h]=(0,n.useState)({fullName:"",line1:"",line2:"",city:"",state:"",postalCode:"",country:"IN",phone:""}),[m,p]=(0,n.useState)({method:"SIMULATED",nameOnCard:"",last4:""});(0,n.useEffect)(()=>{(async()=>{let[e,s,a]=await Promise.all([fetch("".concat(i,"/cart"),{credentials:"include"}).then(e=>e.json()),fetch("".concat(i,"/products")).then(e=>e.json()),fetch("".concat(i,"/addresses"),{credentials:"include"}).then(e=>e.json()).catch(()=>({addresses:[]}))]);t(e.items||[]),l(s.products||[]);let n=(a.addresses||[]).find(e=>e.isDefault)||(a.addresses||[])[0];n&&h({fullName:n.fullName,line1:n.line1,line2:n.line2||"",city:n.city,state:n.state,postalCode:n.postalCode,country:n.country,phone:n.phone})})()},[]);let f=e.reduce((e,t)=>{let a=t.productId||t.product_id,n=s.find(e=>e.id===a);return e+(n?n.priceCents*t.qty:0)},0);async function j(){let e=await fetch("".concat(i,"/discounts/validate"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:c})}),t=await e.json();e.ok?o(t.discount_cents||0):(o(0),alert(t.error||"Invalid code"))}async function x(){let e=await fetch("".concat(i,"/orders/checkout"),{method:"POST",credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:c,shippingAddress:u,payment:m})}),t=await e.json();if(!e.ok){alert(t.error||"Checkout failed");return}window.location.href="/orders"}return(0,a.jsxs)("section",{className:"container",children:[(0,a.jsx)("div",{className:"topbar",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"badge",children:"Checkout"}),(0,a.jsx)("h2",{children:"Shipping & Payment"})]})}),(0,a.jsxs)("div",{className:"grid",style:{gridTemplateColumns:"1fr 1fr",gap:20},children:[(0,a.jsxs)("div",{className:"form",children:[(0,a.jsx)("h3",{children:"Shipping Address"}),["fullName","line1","line2","city","state","postalCode","country","phone"].map(e=>(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{children:e}),(0,a.jsx)("input",{className:"input",value:u[e]||"",onChange:t=>h({...u,[e]:t.target.value})})]},e)),(0,a.jsx)("h3",{children:"Payment (Simulated)"}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{children:"Name on Card"}),(0,a.jsx)("input",{className:"input",value:m.nameOnCard||"",onChange:e=>p({...m,nameOnCard:e.target.value})})]}),(0,a.jsxs)("div",{className:"field",children:[(0,a.jsx)("label",{children:"Last 4 digits"}),(0,a.jsx)("input",{className:"input",value:m.last4||"",onChange:e=>p({...m,last4:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"cart-panel",children:[(0,a.jsx)("div",{style:{fontWeight:700,marginBottom:".5rem"},children:"Order Summary"}),0===e.length?(0,a.jsx)("div",{className:"sub",children:"Your cart is empty."}):e.map((e,t)=>{let n=e.productId||e.product_id,i=s.find(e=>e.id===n),l=i?i.priceCents*e.qty:0;return(0,a.jsxs)("div",{className:"row",children:[(0,a.jsxs)("div",{children:[(null==i?void 0:i.name)||"PID "+n," \xd7 ",e.qty]}),(0,a.jsxs)("div",{children:["₹",(l/100).toFixed(2)]})]},t)}),(0,a.jsxs)("div",{className:"row",style:{borderBottom:0},children:[(0,a.jsx)("div",{style:{flex:1},children:(0,a.jsx)("input",{className:"input",placeholder:"Promo code",value:c,onChange:e=>d(e.target.value)})}),(0,a.jsx)("button",{className:"btn ghost",onClick:j,style:{marginLeft:8},children:"Apply"})]}),(0,a.jsxs)("div",{className:"total",children:["Subtotal: ₹",(f/100).toFixed(2)]}),(0,a.jsxs)("div",{className:"total",style:{color:r>0?"#22c55e":void 0},children:["Discount: -₹",(r/100).toFixed(2)]}),(0,a.jsxs)("div",{className:"total",children:["Payable: ₹",(Math.max(0,f-r)/100).toFixed(2)]}),(0,a.jsx)("div",{className:"actions",children:(0,a.jsx)("button",{className:"btn",onClick:x,disabled:0===e.length,children:"Place Order"})})]})]})]})}}},function(e){e.O(0,[971,69,744],function(){return e(e.s=8747)}),_N_E=e.O()}]);